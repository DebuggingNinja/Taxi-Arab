/*
 * Headwall Photonics 2018
 */
/*
 * Headwall Photonics 2017
 * Blair Simon
 */
Ext.Loader.setConfig({enabled:true});var pArea;var coordinates;var oldAddress;var finished=false;"use strict";Ext.onReady(function(){try{Ext.QuickTips.init();var c=false;c=urlCheck();finished=layoutBuild(c,setVisiblity)}catch(b){var a="There was an error loading this page.\nError description: "+b.message+"\n\n";alert(a)}});function layoutBuild(e,f){address=Ext.create("Ext.form.field.Text",{value:"580 Main St, Bolton, MA 01740",width:220,region:"center",allowBlank:false,listeners:{specialkey:function(h,g){if(g.getKey()==g.ENTER||g.getKey()==g.TAB){oldAddress=address.value;address2LatLong(address.value)}}}});oldAddress=address.value;latitude=Ext.create("Ext.form.field.Number",{decimalPrecision:6,value:42.429423});longitude=Ext.create("Ext.form.field.Number",{decimalPrecision:6,value:-71.599326});pArea=Ext.create("Ext.form.field.Number",{decimalPrecision:2,readOnly:true,width:90});coordinates=Ext.create("Ext.form.field.TextArea",{region:"center",value:null,emptyText:"# Polygon Name\nLatitude, Longitude",readOnly:true});var d=new Ext.Toolbar;Ext.create("Ext.Viewport",{xtype:"box",layout:"border",title:"test",items:[{xtype:"box",el:"header",region:"north",height:106},{xtype:"panel",layout:"border",region:"north",dockedItems:[{xtype:"toolbar",dock:"top",items:["Address (powered by Google):",address,"Latitude:",latitude,"Longitude:",longitude,{xtype:"button",text:"Go To",handler:function(){if(oldAddress==address.value){reCenter(latitude.getValue(),longitude.getValue())}else{oldAddress=address.value;address2LatLong(address.value);reCenter(latitude.getValue(),longitude.getValue())}}}]},{xtype:"toolbar",dock:"top",items:["Area (m^2):",pArea,"-",{xtype:"button",text:"Refresh Coordinates",id:"Refresh_Button",cls:"all",tooltip:"Force a refresh the coordinate information for all polygons",handler:function(){if(allPolys[myIndex]!=null){updateCoord(allPolys[myIndex].getPath(),allPolys[myIndex].content)}}},"-",{xtype:"button",text:"Clear Polygon",id:"Clear_Poly_Button",cls:"all",tooltip:"Remove the current polygon",handler:function(){clearCurrentPoints(currentPoly)}},{xtype:"button",text:"New Polygon",id:"New_Poly_Button",cls:"all",tooltip:"Close current polygon and start a new polygon (same as Right Click)",handler:closePoly},{xtype:"button",text:"Clear All Polygons",id:"Clear_All_Poly_Button",cls:"all",tooltip:"Clear all polygons and start over",handler:function c(){if(e){try{polygonEditWin.clearAllPolygons()}catch(g){errMsg("polygonEditWin.clearAllPolygons",g)}}else{clearAllPoints()}}},"-",{xtype:"button",text:"Import Text",id:"Import_Txt_Button",cls:"all",tooltip:"Enter a string of latitude and longitude values to create a polygon",handler:function(){Ext.MessageBox.show({title:"Import Polygon",msg:"Please enter your Polygon. Doing this will clear all current polygons. The polygon points need to be in latitude,longitude pairs:",width:350,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:function(g,h){if(g=="ok"){polyImport(h)}}})}},{xtype:"button",text:"Export Text",id:"Export_Txt_Button",cls:"web",tooltip:"All the user made polygons are listed in the Coordinates box at the bottom of the page",handler:exportPolys},{xtype:"button",text:"Save as text file",id:"Save_To_Txt_File_Button",cls:"hsiii",tooltip:"Save as a text file on the local computer",handler:function(){closePoly();var k="";for(var h=0;h<myIndex;h++){var l=allPolys[h].getPath();var g=allPolys[h].content;k=exportPolyPrep(l,k,g)}try{polygonEditWin.saveTxt(k)}catch(j){errMsg("polygonEditWin.saveTxt",j)}}},"-",{xtype:"filefield",buttonText:"Import KML",id:"Import_KML_Button",cls:"all",tooltip:"Import a KML file from the local computer and convert that KML file into a polygon",buttonOnly:true,hideLabel:true,listeners:{afterrender:function(g){document.getElementById(g.getId()).addEventListener("change",readSingleFile,false)}}},{xtype:"button",text:"Export KML",id:"Export_KML_Button",cls:"all",tooltip:"Save the polygons as a KML file, which can be downloaded to the local computer",handler:function(){var i="userData.kml";var j="text/plain";var h="No KML values";closePoly();if(e){readIn(allPolys,function(k){try{polygonEditWin.saveKml(k)}catch(l){errMsg("polygonEditWin.saveKml",l)}})}else{readIn(allPolys,function g(k){var l=Ext.create("Ext.window.Window",{title:"KML Output",width:750,height:300,bodyPadding:10,layout:{type:"vbox",align:"center"},items:[{xtype:"textareafield",value:k,readOnly:true,anchor:"100%",autoScroll:true,width:"100%",flex:5},{xtype:"button",text:"save KML",handler:function(){download(k,i,j)}}]});l.show()})}}},{xtype:"button",text:"Apply polygons",cls:"hsiii",tooltip:"Upload the polygons to an attached Headwall Nano",handler:function(){try{exportPolys();polygonEditWin.applyPolygons()}catch(g){errMsg("polygonEditWin.applyPolygons",g)}}},{xtype:"button",text:"Resize Map",id:"Resize_Map_Button",cls:"hsiii",tooltip:"Refresh the current map",handler:function(){try{polygonEditWin.resizeMap()}catch(g){errMsg("polygonEditWin.resizeMap",g)}}},"-",{xtype:"filefield",buttonText:"Plot Flight",id:"plot_gps_data",cls:"web",tooltip:"Plot decimated flight path on Google Maps",buttonOnly:true,hideLabel:true,listeners:{afterrender:function b(g){document.getElementById(g.getId()).addEventListener("change",readSingleFile,false)}}},{xtype:"filefield",buttonText:"Plot gpsMonitor",id:"plot_gpsMonitor",cls:"web",tooltip:"",buttonOnly:true,hideLabel:true,listeners:{afterrender:function a(g){document.getElementById(g.getId()).addEventListener("change",readSingleFile,false)}}},{xtype:"button",text:"Clear Flight Plot",id:"clear_flight_plot",cls:"web",tooltip:"clear plotted flight path",handler:clearPolyLine}]}]},{xtype:"box",region:"center",html:'<div id="mapC"></div>'},{id:"coordinatesBox",region:"south",title:"Coordinates (Latitude, Longitude):",height:120,resizable:true,collapsible:true,layout:"border",items:[coordinates],cls:"web"},],renderTo:Ext.getBody()});initialize();f(e);return true}
/*
 * Headwall Photonics 2017
 * Blair Simon
 */
"use strict";var map;var allPolys=[];var myIndex=0;var infoWindow;var currentPoly=null;function initialize(){var d=13;var c=new google.maps.LatLng(42.429423,-71.599326);var b=document.getElementById("mapC");var a={zoom:d,center:c,tilt:0,disableDoubleClickZoom:true,mapTypeId:google.maps.MapTypeId.SATELLITE,gestureHandling:"auto"};map=new google.maps.Map(b,a);map.addListener("click",addPoint);google.maps.event.addListener(map,"rightclick",closePoly);infoWindow=new google.maps.InfoWindow()}function createPoly(b){var a=checkEvent(b);var c=new Array();currentPoly=myIndex;allPolys[myIndex]=new google.maps.Polygon({paths:c,strokeWeight:3,strokeColor:"#000000",fillColor:"#5555FF",fillOpacity:0.25,strokeOpacity:0.75,editable:true,content:a,localInd:myIndex})}function checkEvent(b){var a="Polygon_"+myIndex.toString();if(typeof b==="undefined"){return a}if(typeof b.name!=="undefined"&&b.name!=null){a=b.name}return a}function addPoint(c){if(typeof allPolys[myIndex]==="undefined"||allPolys[myIndex]==null){createPoly(c)}var b=new google.maps.MVCArray();if(allPolys[myIndex].getPath()!=null){b=allPolys[myIndex].getPath();allPolys[myIndex].content=checkEvent(c)}b.push(c.latLng);allPolys[myIndex].setPath(b);allPolys[myIndex].setMap(map);if(allPolys[myIndex].getPath().length==1){var a=allPolys[myIndex];updateCoord(a.getPath(),a.content);google.maps.event.addListener(a.getPath(),"set_at",function(){updateCoord(this,a.content)});google.maps.event.addListener(a.getPath(),"insert_at",function(){updateCoord(this,a.content)});google.maps.event.addListener(a,"click",function(d){myPolyEdit(this,d);updateCoord(this.getPath(),this.content);currentPoly=this.localInd});google.maps.event.addListener(a,"dblclick",function(d){showPolyName(this,d)})}}function showPolyName(d,c){var a=d.getPath();var f="<b>Name:"+d.content+"</b><br>Clicked location: <br>"+c.latLng.lat()+","+c.latLng.lng()+"<br>";for(var b=0;b<a.getLength();b++){var e=a.getAt(b);f+="<br>Coordinate "+b+":<br>"+e.lat()+","+e.lng()}infoWindow.setContent(f);infoWindow.setPosition(c.latLng);infoWindow.open(map)}function closePoly(){if(allPolys[myIndex]==null){return}var a=allPolys[myIndex].getPath();if(a==null){return}var b=allPolys[myIndex].getMap();if(a.length!=0&&typeof(b)!=="undefined"){updateCoord(a,allPolys[myIndex].content);myIndex=myIndex+1;createPoly();updateCoord(allPolys[myIndex].getPath(),allPolys[myIndex].content)}}function myPolyEdit(a,c){if(c.vertex==null||a==null){return}var b=a.getPath();b.removeAt(c.vertex);a.setPath(b);a.setMap(map)}function polyArea(b){if((b==null||allPolys[myIndex]==null)&&pArea){pArea.setValue(0);return}if(b.length>2&&pArea){var a=google.maps.geometry.spherical.computeArea(b);pArea.setValue(a)}else{pArea.setValue(0)}}function polyReadOut(a){var c="";var b=/[\(\)]/g;a.forEach(function(e,f,d){c+=e.toString();c=c.replace(b,"");c=c+"\n"});return c}function exportPolyPrep(d,e,c){if(d!=null){if(typeof c==="undefined"){e+="#\n"}else{e+="#"+c+"\n"}var b=polyReadOut(d);e+=b}return e}function exportPolys(){coordinates.setValue(null);if(allPolys[myIndex]==null&&myIndex==0){coordinates.setValue(" ");return}if(allPolys[myIndex].getPath()==null){myIndex--}if(allPolys[myIndex].getPath().length>0){closePoly()}var c="";for(var b=0;b<myIndex;b++){if(allPolys[b]==null){continue}var d=allPolys[b].getPath();var a=allPolys[b].content;c=exportPolyPrep(d,c,a)}if(c.length<=0){coordinates.setValue(" ")}else{coordinates.setValue(c)}}function updateCoord(a,b){var c="";c=exportPolyPrep(a,c,b);coordinates.setValue(c);polyArea(a)}function clearCurrentPoints(b){if(allPolys[b]==null){return}if(allPolys[b].getPath()==null){return}if(pArea){pArea.setValue(0)}google.maps.event.clearListeners(allPolys[b].getPath(),"insert_at");google.maps.event.clearListeners(allPolys[b],"click");google.maps.event.clearListeners(allPolys[b].getPath(),"set_at");google.maps.event.clearListeners(allPolys[b],"dblclick");var c=allPolys[b].getPath().getLength();for(var a=0;a<c;a++){allPolys[b].getPath().removeAt(0)}allPolys[b]=null;coordinates.setValue("");currentPoly=myIndex}function clearAllPoints(){for(var a=myIndex;a>=0;a--){clearCurrentPoints(a)}myIndex=0;allPolys=[]}function reCenter(c,b){var a=new google.maps.LatLng(c,b);map.setCenter(a)}function address2LatLong(a){var b=new google.maps.Geocoder();b.geocode({address:a},function(e,c){if(c==google.maps.GeocoderStatus.OK){map.setCenter(e[0].geometry.location);var f=latitude.setValue(e[0].geometry.location.lat());var d=longitude.setValue(e[0].geometry.location.lng())}else{alert("Geocode was not successful for the following reason: "+c)}})}function minMax(e,c,d){var b=Math.abs(e);var a=Math.abs(c);if(d.maxLat===null){d.maxLat=e}else{if(b>d.maxLat){d.maxLat=e}}if(d.minLat===null){d.minLat=e}else{if(b<d.minLat){d.minLat=e}}if(d.maxLng===null){d.maxLng=c}else{if(a>d.maxLng){d.maxLng=c}}if(d.minLng===null){d.minLng=c}else{if(a<d.minLng){d.minLng=c}}}function applyImportPoly(d,e){if(d==null){return}var c=new google.maps.LatLngBounds();var b={maxLng:null,minLng:null,maxLat:null,minLat:null};var a={lat:0,lng:0};if(e){insertPolygon(d,c,b)}else{insertPolyline(d,c,b)}a.lat=b.minLat+((b.maxLat-b.minLat)/2);a.lng=b.minLng+((b.maxLng-b.minLng)/2);reCenter(a.lat,a.lng);map.fitBounds(c)}function insertPolygon(f,e,d){for(var h=0;h<f.length;h++){var c={name:null,latLng:null};c={name:f[h].name};for(var a=0;a<f[h].lat.length;a++){var g=f[h].lat[a];var b=f[h].lng[a];c.latLng=new google.maps.LatLng(g,b);addPoint(c);e.extend(c.latLng);minMax(g,b,d)}closePoly()}}function parseImport(h,f){var e=[];var k=[];var l=/\s*\n*#\s*\n*/g;var a=h.split(l);l=/\s*\n/;a.forEach(function(o,n,m){e[n]=o.split(l)});e.shift();l=/\s*,\s*/;for(var b=0;b<e.length;b++){f[b]={name:null,lat:new Array,lng:new Array};for(var c=0;c<e[b].length;c++){k=e[b][c].split(l);var d=parseFloat(k[0]);var g=parseFloat(k[1]);var j=checkFloat(d);var i=checkFloat(g);if(j&&i){f[b].lat.push(d);f[b].lng.push(g)}else{if(e[b][c].match(/\w*/g)!=null&&e[b][c].length>0){f[b].name=e[b][c]}}k=[]}closePoly()}}function polyImport(b){clearAllPoints();var a=[];parseImport(b,a);applyImportPoly(a,true)}function urlCheck(){var b=null;b=document.location.search.substring(1);if(typeof b==="undefined"||b==null){return false}var a=parseQueryString(b);if(a.hsiii==="true"){return true}else{return false}return false}function parseQueryString(f){var d=f.split("&");var c={};for(var b=0;b<d.length;b++){var e=d[b].split("=");if(typeof c[e[0]]==="undefined"){c[e[0]]=decodeURIComponent(e[1])}else{if(typeof c[e[0]]==="string"){var a=[c[e[0]],decodeURIComponent(e[1])];c[e[0]]=a}else{c[e[0]].push(decodeURIComponent(e[1]))}}}return c}function setVisiblity(c){var a=Ext.query(".hsiii");buttonVis(a,c);var b=Ext.query(".web");buttonVis(b,!c);if(c){loadJS("qwebchannel.js")}}function loadJS(b){var a=document.createElement("script");a.type="application/javascript";a.src=b;document.body.appendChild(a)}function buttonVis(b,d){for(var a=0;a<b.length;a++){var c=Ext.getCmp(b[a].id);c.setVisible(d)}}function errMsg(c,a){var b=null;baseMessage=" to be used only with Headwall HSIII Software. To prevent this issue make sure that the webURL is apps.headwallphotonics.com";b="Function: "+c+baseMessage+"\nError Message: "+a;alert(b)}function checkFloat(a){var b=(a==null);var c=(typeof a==="string");var d=isFinite(a);if(d&&!c&&!b){return true}else{return false}}function makeStruct(c){var c=c.split(" ");var b=c.length;function a(){for(var d=0;d<b;d++){this[c[d]]=arguments[d]}}return a}
/*
 * Headwall Photonics 2017
 * Blair Simon
 */
"use strict";function readIn(g,f){var a=[];var e=[];if(typeof g==="undefined"||typeof g[0]==="undefined"||typeof g[0].getPath()==="undefined"){b="No KML values";f(b);return}for(var c=0;c<myIndex;c++){if(g[c]==null){a[c]=null;e[c]=null}else{a[c]=g[c].getPath();e[c]=g[c].content}}var b="";var d="";b+=header();var c=0;eachPolygon(a,e,function(h){b+=h;if(c==a.length-1){b+=endline();f(b)}c++})}function header(){var a='<?xml version="1.0" encoding="UTF-8"?>\n';a+='<kml xmlns="http://www.opengis.net/kml/2.2">\n';a+="\t<Document>\n";return a}function endline(){var a="\t</Document>\n";a+="</kml>";return a}function eachPolygon(a,g,h){var c="";for(var d=0;d<a.length;d++){if(a[d]==null||g[d]==null){h(c);continue}var f=a[d];var b=g[d];if(f.length==0){h(c);continue}var e="";xmlPoly(f,b,function(i){c=i;h(c)})}}function headerLocal(b,a,d){var c=a+"<Placemark>"+d;c+=a+a+"<name>"+b+"</name>"+d;c+=a+a+"<description>User created polygon using Headwall Photonics's polygon tool. Altitude Values for the surface of the ground. Coordinates are in Longitude, Latitude, Altitude triplets.</description>"+d;c+=a+a+"<Polygon>"+d;c+=a+a+a+"<extrude>1</extrude>"+d;c+=a+a+a+"<tessellate>1</tessellate>"+d;c+=a+a+a+"<altitudeMode>absolute</altitudeMode>"+d;c+=a+a+a+"<outerBoundaryIs>"+d;c+=a+a+a+a+"<LinearRing>"+d;c+=a+a+a+a+a+"<coordinates>"+d;return c}function endlingLocal(a,c){var b=a+a+a+a+a+"</coordinates>"+c;b+=a+a+a+a+"</LinearRing>"+c;b+=a+a+a+"</outerBoundaryIs>"+c;b+=a+a+"</Polygon>"+c;b+=a+"</Placemark>"+c;return b}function xmlPoly(e,h,j){var d="\t";var b="\n";var f="";var i=polyReadOut(e);var g=i.split("\n");g.pop();var c=new Array();getAvgAlt(e,function(a){f+=headerLocal(h,d,b);for(var l=0;l<g.length;l++){var k=g[l].split(",");f+=d+d+d+d+d+d+k[1]+","+k[0]+","+a[l].toString()+b}k=g[0].split(",");f+=d+d+d+d+d+d+k[1]+","+k[0]+","+a[0].toString()+b;f+=endlingLocal(d,b);j(f)})}function getAvgAlt(e,f){var d=new google.maps.ElevationService;var c=new Array();for(var b=0;b<e.length;b++){c[b]=e.getAt(b)}var a=new Array();d.getElevationForLocations({locations:c},function(h,g){if(g==="OK"){h.forEach(function(k,j){a[j]=k.elevation})}else{alert("Elevation service failed due to: "+g)}f(a)})}function download(g,c,f){var e=new Blob([g],{type:f});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(e,c)}else{var b=document.createElement("a"),d=URL.createObjectURL(e);b.href=d;b.download=c;document.body.appendChild(b);b.click();setTimeout(function(){document.body.removeChild(b);window.URL.revokeObjectURL(d)},0)}}
/*
 * Headwall Photonics 2017
 * Blair Simon
 */
"use strict";function readSingleFile(c){closePoly();var b=c.target.files[0];var a=c.target.name;if(b){getAsText(b,a)}}function getAsText(b,d){var a=new FileReader();var c=null;var e=null;a.onprogress=function(f){c=Ext.create("Ext.ProgressBar");e=Ext.MessageBox.show({msg:"Loading file, please wait...",progressText:"Loading...",width:300,closable:true,wait:true})};a.onload=function(f){c.reset();c.updateText("Saved Successfully!");e.hide();switch(d){case"Import_KML_Button-inputEl":parseKML(a.result);break;case"plot_gps_data-inputEl":parseGPS(a.result);break;case"plot_gpsMonitor-inputEl":parseGpsMon(a.result);break;default:}};a.onerror=errorHandler;a.readAsText(b,null)}function errorHandler(a){switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case a.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case a.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}}
/*
 * Headwall Photonics 2018
 * Blair Simon
 * Load the imu_gps.txt file 
 */
"use strict";function parseGPS(g){var e=null;var c=g.split(/\r\n|\r|\n/g);if(typeof c.findIndex==="function"){for(var d=0;d<10;d++){e=getHeader(c[d],d);if(e!=null){break}}if(e==null){alert("Failed to find valid imu_gps.txt header. Please check the file and try again.");return}var b=0.000001;var f=getUniquePairs(c,e,b);var a=decimate(f,e);plotLatLon(a)}else{alert("findIndex API call is not supported by this browser, use a more modern browser.")}}function getUniquePairs(p,g,o){var a=[];var b=[];var k=0;for(var c=(g[2]+1);c<p.length;c++){var j=p[c].split("\t");if(j.length==g[3]){var f=parseFloat(j[g[0]]);var h=parseFloat(j[g[1]]);if(!checkFloat(f)||!checkFloat(h)){continue}if(c==(g[2]+1)){a[k]=f;b[k]=h}else{var d=Math.abs(a[k]-f);var e=Math.abs(b[k]-h);for(var m=k;m<c;m++){var l=0;var n=0}if((d>=o)||(e>=o)||(l>=o)||(n>=o)){k++;a[k]=f;b[k]=h}}}}return[a,b]}function decimate(d,f){var c=makeStruct("lat lng");var b=[];var a=1;if(d[0].length>101){a=calStepSize(d[0].length)}if(a===null){a=1}for(var e=0;e<d[0].length;e+=a){var g=new c(d[0][e],d[1][e]);b.push(g)}return b}function isLon(c,b,d){var a=c.search("Lon");if(a!=-1){return b}}function isLat(c,b,d){var a=c.search("Lat");if(a!=-1){return b}}function getHeader(a,e){var d=a.split("\t");var f=null;var b=null;f=d.findIndex(isLat);b=d.findIndex(isLon);if((f!==null)&&(b!==null)){var c=[f,b,e,d.length];return c}}function calStepSize(f){var c=1;var b=1;var a=0;var e=false;for(var d=0;d<10;d++){a=f/c;if(((a-100)<=0.1)&&((a-100)>=-0.1)){e=true;break}b*=10;c=Math.round(f/b)}if(e){return c}else{c=null;return c}}
/*
 * Headwall Photonics 2018
 * Blair Simon
 * Load the gpsMonitor.json file 
 */
"use strict";function parseGpsMon(d){var e=null;var c=new Array;if(typeof JSON.parse==="function"){try{e=JSON.parse(d)}catch(a){alert("Failed to parse JSON file, please check the file and try again.");return}}else{alert("JSON.parse API call is not supported by this browser. Please use a more modern browser.");return}var b=e.polygons.length;if(b!==undefined&&b!==null&&b>0){buildPolyStruct(c,e,b)}else{alert("No valid polygons found. Check the file to make sure that the keyword polygon is defined as well as the keyword array.");return}applyImportPoly(c,true)}function buildPolyStruct(e,f,h){for(var c=0;c<h;c++){e[c]={name:null,lat:new Array,lng:new Array};e[c].name="Polygon_"+c.toString();var g=f.polygons[c].name.toString();if(g.length!==0){e[c].name=g}var a=f.polygons[c].array.length;if((a%2)!=0&&a>2){a--}else{if((a%2)!=0&&a<2){continue}}for(var j=0;j<a;j+=2){var d=parseFloat(f.polygons[c].array[j]);var b=parseFloat(f.polygons[c].array[j+1]);if(checkFloat(d)&&checkFloat(b)){e[c].lat.push(b);e[c].lng.push(d)}}}}
/*
 * Headwall Photonics 2018
 * Blair Simon
 * Plot the imu_gps.txt file on the google maps
 */
"use strict";function plotLatLon(a){clearPolyLine();applyImportPoly(a,false)}function insertPolyline(b,e,d){map.data.myPolyLine=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,map:map,path:b});for(var c=0;c<b.length;c++){var a=b[c].lat;var f=b[c].lng;minMax(a,f,d);e.extend(new google.maps.LatLng(a,f))}}function clearPolyLine(){if((typeof map.data.myPolyLine==="undefined")||(map.data.myPolyLine==null)){return}map.data.myPolyLine.setMap(null)}
/*
 * Headwall Photonics 2017
 * Blair Simon
 */
"use strict";function parseKML(q){var p=[];var g=null;if(window.DOMParser){var c=new DOMParser();try{g=c.parseFromString(q,"text/xml")}catch(d){var l="There was an error parsing the XML file.\nError description: "+d.message+"\n\n";alert(l)}}else{try{g=new ActiveXObject("Microsoft.XMLDOM");g.async=false;g.loadXML(q)}catch(d){var l="There was an error parsing the XML file.\nError description: "+d.message+"\n\n";alert(l)}}var w=g.getElementsByTagName("name");var t=g.getElementsByTagName("coordinates");var j=w.length;var e=0;if(j!=t.length){while(e<(j-1)){var h=w[e].compareDocumentPosition(t[0])===4;var o=w[e+1].compareDocumentPosition(t[0])===2;if(h&&o){break}e++}if(e==j){console.log("names and coords dont match");alert("Error! There does not seem to be any coordinates in the XML file.");return}}var u=0;for(var r=(0+e);r<j;r++){p.push({name:w[r].childNodes[0].nodeValue});var i=t[u].childNodes[0].nodeValue.split(/[,\r\n\s]+/g);i=removeEmptyArrayElements(i);p[u].lat=[];p[u].lng=[];for(var s=0;s<i.length-3;s+=3){var f=parseFloat(i[s+1]);var v=parseFloat(i[s+0]);var a=checkFloat(f);var b=checkFloat(v);if(a&&b){if(checkForDuplicateCoord(p[u].lat,p[u].lng,f,v)){p[u].lat.push(f);p[u].lng.push(v)}}}u++}applyImportPoly(p,true)}function checkForDuplicateCoord(b,c,d,e){if(b.length<=0){return true}for(var a=0;a<b.length;a++){if(b[a]==d&&c[a]==e){return false}}return true}function removeEmptyArrayElements(a){var b=-1;do{b=a.indexOf("");if(b!=-1){a.splice(b,1)}}while(b!=-1);return a};